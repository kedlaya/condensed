<section xml:id="sec_analytic_stacks1">
  <title>Algebraic versus analytic stacks</title>
  <introduction>
    <p>
      In this section, we think carefully about algebraic stacks and make a first pass at the definition of an analytic stack.
    </p>
    <paragraphs>
      <title>Reference</title>
      <p>
        This section is based on <xref ref="bib-Clausen-Scholze-youtube"/>, Lecture 15.
      </p>
    </paragraphs>
  </introduction>
  <subsection>
    <title>Schemes as functors</title>
    <p>
      In preparation for introducing analytic stacks, we recall some generalities about the construction of schemes out of the category of rings.
    </p>
    <definition xml:id="def-quasicoherent-sheaf-on-functor">
      <p>
        Recall that for <m>R \in \Ring</m>, the category of <m>R</m>-modules is equivalent to the category of quasicoherent sheaves on <m>R</m>.
        In particular, if we knew what it meant to define a quasicoherent sheaf <m>M</m> on a functor <m>F \in \Fun^{\acc}(\Ring^{\op}, \Set)</m>,
        then we should be able to pull back along an element <m>F(R)</m> (i.e., a morphism <m>\Spec R \to F</m>) to obtain an object of <m>\Mod_R</m>,
        in such a way that pulling back further along <m>\Spec S \to \Spec R</m> coincides with base extension of modules <m>\Mod_R \to \Mod_S</m>.
      </p>
      <p>
        This suggests the following definition.
        Let <m>\Mod</m> be the category consisting of pairs <m>(R, M)</m> in which <m>R \in \Ring</m> and <m>M \in \Mod_R</m>,
        with morphisms <m>(R, M) \to (S, N)</m> given by a morphism <m>S \to R</m> in <m>\Ring</m> and an isomorphism <m>N \otimes_S R \cong M</m>.
        By construction, <m>\Mod</m> is fibered in groupoids over <m>\Ring^{\op}</m>.
      </p>
      <p>
        For <m>F \in \Fun^{\acc}(\Ring^{\op}, \Set)</m>, a <term>quasicoherent sheaf</term> on <m>F</m>
        consists of a functor <m>M \in \Fun(\Ring^{\op}, \Set \times \Mod)</m> 
        whose projection along <m>\Set \times \Mod \to \Set</m> is identified with <m>F</m> and whose projection along <m>\Set \times \Mod \to \Mod</m>
        is itself a section of <m>\Mod \to \Ring^{\op}</m>.
        Let <m>\QCoh(F)</m> denote the resulting category; it is again fibered in groupoids over <m>\Ring^{\op}</m> and the fibers are symmetric monoidal.
      </p>
      <p>
        For <m>F = R \in \Ring^{\op}</m>, the restriction functor <m>F \to \Mod_R</m> is an equivalence, but this hides a crucial piece of input:
        the category <m>\Mod</m> satisfies descent for faithfully flat morphisms of rings,
        or equivalently, quasicoherent sheaves on affine schemes are sheaves for the fpqc topology (<xref ref="bib-Stacks"/>, tag 023R).
      </p>
    </definition>
  </subsection>
  <subsection>
    <title>Functors as geometric objects</title>
    <remark xml:id="rem-accessible">
      <p>
        The contravariant functor <m>\Spec</m> associates to every ring a locally ringed space (an <term>affine scheme</term>)
        in such a way that induces an anti-equivalence on its essential image (as a full subcategory).
        One can short-circuit this by simply defining the category of affine schemes to be <m>\Ring^{\op}</m>,
        and giving it the Grothendieck topology generated by finite jointly surjective families of open immersions (or even distinguished open immersions).
      </p>
      <p>
        By Yoneda, we can map affine schemes into the functor category <m>\Fun(\Ring^{\op}, \Set)</m>.
        This category is quite large, so it is better to cut it down: we restrict to functors which are <term>accessible</term>, meaning that they are <em>small</em>
        colimits of representable functors (in general, the co-Yoneda lemma requires colimits that are not small).
        Denote the full subcategory of accessible functors by <m>\Fun^{\acc}(\Ring^{\op}, \Set)</m>.
      </p>
      <p>
        We can now embed the whole category of schemes as a full subcategory of <m>\Fun^{\acc}(\Ring^{\op}, \Set)</m>,
        or even into the subcategory of sheaves for the Zariski topology. However, there are a lot more functors in this category than schemes!
        An object <m>X \in \Fun^{\acc}(\Ring^{\op}, \Set)</m> is a scheme if and only if it occurs as colimit of representable functors in a very special way:
        there should exist a small family of morphisms <m>X_i \to X</m> out of affine schemes such that the disjoint union <m>\sqcup_i X_i</m> surjects onto <m>X</m> (in the sense of sheaves)
        <em>and</em> each morphism <m>X_i \to X</m> is itself an open immersion. The latter condition means that for any affine scheme <m>S</m> and any morphism <m>S \to X</m>,
        the object <m>X_i \times_X S</m> is itself an affine scheme and the morphism <m>X_i \times_X S \to S</m> is an open immersion of affine schemes.
      </p>
      <p>
        In particular, the functors corresponding to schemes are sheaves for one of various Grothendieck topologies on <m>\Ring^{\op}</m>
        (the key property we need is that the topology is <term>subcanonical</term>).
        For example, we can replace <m>\Fun^{\acc}(\Ring^{\op}, \Set)</m> with the subcategory <m>\Shv_{\fpqc}^{\acc}(\Ring^{\op}, \Set)</m>
        of sheaves for the <term>fpqc topology</term>, in which the coverings are generated by faithfully flat morphisms.
        (As the coverings are not generated by a small collection, we must retain the accessible condition to maintain enough set-theoretic control to handle this object.)
      </p>
      <p>
        In the other direction, we can relax the requirements on what kind of covering a functor <m>X</m> must admit to be allowed as a geometric object.
        For instance, if we allow coverings by small families of morphisms out of affine schemes in which each morphism is etale, 
        we get the category of Deligne<ndash/>Mumford stacks; this captures such examples as quotients by finite group actions and moduli spaces of curves.
        If we allow coverings in which each morphism is smooth, we get the category of Artin stacks; this captures such examples as quotients by algebraic group actions.
      </p>
      <p>
        However, there are other functors on <m>\Ring^{\op}</m> that do not fit even into the framework of Artin stacks, but
        are natural constructions that we would like to treat as <q>geometric objects</q>.
      </p>
    </remark>
    <example>
      <p>
        Let <m>G</m> be an algebraic group over a field <m>k</m>.
        The <term>loop group</term> of <m>G</m> is the functor associating to <m>R \in \Ring^{\op}</m> the set of pairs consisting of a morphism <m>k \to R</m>
        (i.e., a map <m>\Spec R \to \Spec k</m>) and an element of the quotient group <m>G_R(R((T)))/G_R(R \llbracket T \rrbracket)</m>
        for <m>G_R := G \times_{\Spec k} \Spec R</m>.
      </p>
    </example>
    <example>
      <p>
        For any noetherian ring <m>R</m> and any ideal <m>I</m>, we may form the colimit <m>\colim_i \Spec R/I^i</m> in the category of <term>formal schemes</term>.
        This colimit also makes sense in <m>\Shv_{\fpqc}^{\acc}(\Ring^{\op}, \Set)</m>.
      </p>
    </example>
    <example>
      <p>
        For <m>R \in \Ring^{\op}</m>, the <term>de Rham stack</term> corresponding to <m>\Spec R</m> is the functor <m>S \mapsto \Hom_{\Ring}(R_{\red}, S_{\red})</m>.
      </p>
    </example>
  </subsection>
  <subsection>
    <title>Stone duality in algebraic stacks</title>
    <p>
      We now specialize the discussion to describe a version of Stone duality
      (<xref ref="rem-Stone-duality"/>, <xref ref="rem-Stone-duality-part-2"/>)
      that embeds the entire category of condensed sets into algebraic stacks.
      We will then formally transfer this construction to analytic stacks.
    </p>
    <lemma xml:id="lem-profinite-sets-to-schemes">
      <statement>
        <p>
          The functor <m>\Prof \to \Ring^{\op}</m> taking <m>S \in \Prof</m> to <m>\Spec \Cts(S, \ZZ)</m> (i.e., locally constant functions from <m>S</m> to <m>\ZZ</m>)
          is fully faithful.
        </p>
      </statement>
      <proof>
        <p>
          Note first that each element of <m>S</m> defines an evaluation homomorphism <m>\Cts(S, \ZZ) \to \ZZ</m>.
          Now fix <m>S = \varprojlim_i S_i</m> and <m>S' = \varprojlim_j S_j \in \Prof</m> and consider a ring homomorphism <m>\Cts(S, \ZZ) \to \Cts(S', \ZZ)</m>.
          For each <m>i</m>, we can form the composition <m>\ZZ^{S_i} = \Cts(S_i, \ZZ) \to \Cts(S, \ZZ) \to \Cts(S', \ZZ)</m>.
          For each <m>s' \in S'</m>, we can restrict the evaluation-at-<m>s'</m> map to get a homomorphism <m>\ZZ^{S_i} \to \ZZ</m>, which then corresponds to a
          particular element <m>s_i \in S_i</m>. Define the map <m>f_i\colon S' \to S_i</m> so that <m>s_i = f_i(s')</m>; we claim that this map is continuous.
          Namely, the composition <m>\ZZ^{S_i} \to \Cts(S', \ZZ) \to \ZZ</m> is determined by the images of the generators of <m>\ZZ^{S_i}</m> in <m>\Cts(S', \ZZ)</m>,
          and all of these factor through <m>\Cts(S'_j, \ZZ)</m> for some <m>j</m>. 
          We now have a coherent sequence of continuous maps <m>f_i \colon S' \to S_i</m>, and the induced map <m>f\colon S' \to S</m> induces the original ring homomorphism.
        </p>
      </proof>
    </lemma>
    <lemma xml:id="lem-profinite-cover-faith-flat">
      <statement>
        <p>
          For <m>S' \to S</m> an arbitrary morphism (resp. a surjective morphism)
          in <m>\Prof</m>, the induced ring homomorphism <m>\Cts(S, \ZZ) \to \Cts(S', \ZZ)</m> is flat (resp. faithfully flat).
        </p>
      </statement>
      <proof>
        <p>
          We can write <m>S = \varprojlim_i S_i</m>, <m>S' = \varprojlim_i S'_i</m> as sequential inverse limits of finite sets with surjective transition maps,
          in such a way that <m>S' \to S</m> is induced by a family of morphisms <m>S' \to S</m>. We have 
          <me>
            \Cts(S, \ZZ) = \colim_i \Cts(S_i, \ZZ) = \colim_i \bigoplus_{s \in S_i} \ZZ
          </me>
          and similarly with <m>S</m> replaced by <m>S'</m>. Each morphism <m>\Cts(S_i, \ZZ) \to \Cts(S'_i, \ZZ)</m> is visibly flat: we may formally reduce to the case
          where <m>S_i</m> is a singleton, and then <m>\Cts(S'_i, \ZZ)</m> is free as a module over <m>\Cts(S_i, \ZZ) = \ZZ</m> and hence flat.
          By taking colimits on both sides, we deduce that <m>\Cts(S, \ZZ) \to \Cts(S', \ZZ)</m> is flat (<xref ref="bib-Stacks"/>, tags 05UT, 05UU).
        </p>
        <p>
          Now assume further that <m>S' \to S</m> is surjective. We can then set up notation as before but with each map <m>S'_i \to S_i</m> surjective.
          Each morphism <m>\Cts(S_i, \ZZ) \to \Cts(S'_i, \ZZ)</m> is now visibly faithfully flat; by the same token, each transition map <m>\Cts(S'_i, \ZZ) \to \Cts(S'_{i+1}, \ZZ)</m>
          is faithfully flat. Again by taking colimits, the map <m>\Cts(S_i, \ZZ) \to \Cts(S', \ZZ)</m> is seen to be faithfully flat
          (if <m>M \to N</m> is an injection of modules over <m>\Cts(S_i, \ZZ)</m> and <m>M \otimes_{\Cts(S_i, \ZZ)} \Cts(S', \ZZ) \to N \otimes_{\Cts(S_i, \ZZ)} \Cts(S', \ZZ)</m>
          fails to be injective, then this is witnessed by some element of some <m>M \otimes_{\Cts(S_i, \ZZ)} \Cts(S'_j, \ZZ)</m>
          mapping to zero in <m>N \otimes_{\Cts(S_i, \ZZ)} \Cts(S', \ZZ)</m>). By the same token, by taking colimits the map <m>\Cts(S, \ZZ) \to \Cts(S', \ZZ)</m>,
          which we already know is flat, is seen to be faithfully flat
          (if <m>M</m> is a finitely generated module over <m>\Cts(S, \ZZ)</m> and <m>M \to M \otimes_{\Cts(S, \ZZ)} \Cts(S', \ZZ)</m> is not injective,
          then this is witnessed by some descent of <m>M</m> to a finitely generated module <m>M_i</m> over <m>\Cts(S, \ZZ)</m> and some nonzero element of <m>M_i</m>
          mapping to zero in <m>M_i \otimes_{\Cts(S_i, \ZZ)} \Cts(S', \ZZ)</m>).
        </p>
      </proof>
    </lemma>
    <definition xml:id="exa-embed-cset-into-schemes">
      <p>
        By <xref ref="lem-profinite-sets-to-schemes"/>, we have a fully faithful functor <m>\Prof \to \Ring^{\op}</m> and hence a full embedding of <m>\Prof</m>
        into <m>\Shv^{\acc}(\Ring^{\op}, \Set)</m>. By <xref ref="lem-profinite-cover-faith-flat"/>, coverings in <m>\Prof</m> correspond to fpqc coverings in <m>\Ring^{\op}</m>.
        We can thus extend the functor <m>\Prof \to \Shv^{\acc}(\Ring^{\op}, \Set)</m> to the whole category <m>\CSet</m> of condensed sets!
        This is more or less the formulation of Stone duality for condensed sets given in <xref ref="bib-Gregoric"/>, Theorem 4.4.
      </p>
      <p>
        We can make this more concrete for <m>X \in \CHaus</m>. 
        In that case, apply <xref ref="rem-construct-profinite-cover"/> to construct a covering <m>S \to X</m> with <m>S \in \Prof</m>. Then
        the functor <m>\CSet \to \Shv^{\acc}(\Ring^{\op}, \Set)</m> takes <m>X</m> to the functor
        <me>
          R \mapsto \Hom_{\Ring}(\Cts(S, \ZZ), R)) \rightrightarrows \Hom_{\Ring}(\Cts(S \times_X S, \ZZ), R))
        </me>;
        this is the limit of the diagram
        <me>
          \Spec \Cts(S \times_X S, \ZZ) \rightrightarrows \Spec \Cts(S, \ZZ)
        </me>.
      </p>
      <p>
        For particular <m>X \in \CHaus</m>, we can make the description even more explicit by fixing a convenient covering <m>S \to X</m>.
        For instance, when <m>X</m> is a closed interval in <m>\RR</m>, we can use the standard covering by the abstract Cantor set
        (<xref ref="exa-cover-interval-by-Cantor-set"/>); this also applies to an interval in the extended real line, such as
        <m>X = [0, \infty]</m>.
      </p>
    </definition>
  </subsection>
  <subsection>
    <title>Functors on analytic rings</title>
    <definition>
      <p>
        By analogy with the relationship between rings and affine schemes, let us write <m>\AnSpec\colon \AnRing \to \Fun(\AnRing^{\op}, \Set)</m> 
        for the contravariant functor taking an analytic ring <m>R</m> to the functor <m>\Hom(\bullet, R)</m>.
        By Yoneda's lemma this defines a full embedding of <m>\AnRing^{\op}</m> into <m>\Fun^{\acc}(\AnRing^{\op}, \Set)</m>.
      </p>
      <p>
        Since we can treat any discrete ring as an analytic ring, we can also view affine schemes as objects in <m>\Fun^{\acc}(\AnRing^{\op}, \Set)</m>.
        In particular, for any analytic ring <m>R</m>, I have a morphism <m>\AnSpec R \to \Spec R^{\triangleright}(*)</m> in the functor category.
      </p>
    </definition>
    <p>
      We would next like to view arbitrary schemes as functors on <m>\AnRing^{\op}</m>.
      As a warmup, let us try to describe <m>\PP^1_\ZZ</m> in this manner.
    </p>
    <definition>
      <p>
        For <m>R</m> an analytic ring, an object <m>L \in \Mod_R</m> is <term>invertible</term> if any of the following equivalent conditions hold.
        <ul>
          <li>
            There exists <m>L^{-1} \in \Mod_R</m> such that <m>L \otimes^L_R L^{-1} \cong R^{\triangleright}</m>.
          </li>
          <li>
            The natural map <m>L \otimes \iHom_R(L, R^{\triangleright}) \to R^{\triangleright}</m> is an isomorphism.
          </li>
        </ul>
      </p>
    </definition>
    <definition>
      <p>
        Define the functor <m>\PP^1_\ZZ</m> on <m>\AnRing^{\op}</m> to carry <m>R \in \AnRing^{\op}</m> to the set of isomorphism classes of short exact sequences
        <me>
          0 \to L_1 \to R^{\triangleright} \oplus R^{\triangleright} \to L_0 \to 0
        </me>
        in <m>\Mod_R</m> with <m>L_0</m> invertible. Note that then <m>L_1</m> is also invertible and <m>L_0 \otimes^L_R L_1 \cong R^{\triangleright}</m>.
      </p>
    </definition>
    <definition>
      <p>
        By analogy with the relationship between rings and affine schemes, let us write <m>\AnSpec\colon \AnRing \to \Fun(\AnRing^{\op}, \Set)</m> 
        for the contravariant functor taking an analytic ring <m>R</m> to the functor <m>\Hom(\bullet, R)</m>.
        By Yoneda's lemma this defines a full embedding of <m>\AnRing^{\op}</m> into <m>\Fun(\AnRing^{\op}, \Set)</m>.
      </p>
      <p>
        We say that a functor in <m>\Fun(\AnRing^{\op}, \Set)</m> is <term>accessible</term> if it is a small colimit of objects in the essential image of <m>\AnSpec</m>.
        Let <m>\Fun^{\acc}(\AnRing^{\op}, \Set)</m> denote the full subcategory of accessible functors in <m>\Fun(\AnRing^{\op}, \Set)</m>.
      </p>
      <p>
        Since we can treat any discrete ring as an analytic ring, we can also view affine schemes as objects in <m>\Fun^{\acc}(\AnRing^{\op}, \Set)</m>;
        by glueing, we can then view arbitrary schemes as objects in <m>\Fun^{\acc}(\AnRing^{\op}, \Set)</m>. Now we can take fiber products to make such objects as
        <m>\PP^1_R := \PP^1_\ZZ \times_{\Spec \ZZ} \AnSpec R</m> for <m>R \in \AnRing</m>.
      </p>
      <p>
        Finally, we map <m>S \in \Prof</m> to <m>\Fun^{\acc}(\AnRing^{\op}, \Set)</m> by first constructing <m>\Spec \Cts(S, \ZZ)</m> and then applying the previous construction
        (so for instance a singleton corresponds to <m>\Spec \ZZ</m>). Using free resolutions (<xref ref="rem-construct-profinite-cover"/>) we can extend the previous
        construction to cover objects of <m>\CHaus</m>, and then by colimits arbitrary to metrizable locally compact Hausdorff topological spaces.
      </p>
    </definition>
  </subsection>
</section>